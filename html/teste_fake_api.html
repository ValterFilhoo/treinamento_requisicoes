<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Praticando requisições Fetch</title>
</head>
<body>

    <nav style="width: 100%; background-color: rgb(229, 232, 232); height: 300px; margin-bottom: 50px; overflow: auto; ">

        <h2 style="text-align: center;">Resultado da requisição GET</h2>

        <ol class="list" style="display: flex; flex-direction: column; align-items: center;">

        </ol>

    </nav>

    <div style="margin-bottom: 100px;">   

        <h2 style="text-align: center;"> Formulário de Cadastro de produto - POST </h2>

        <form class="formPost" id="formPut" style="display: flex; flex-direction: column; gap: 50px; width: 80%; align-items: center; justify-content: center; margin: 0 auto;">

            <input type="text" name="title" id="title" required placeholder="Título">
            <input type="number" name="price" id="price" required placeholder="Price">
            <input type="text" name="description" id="description" required placeholder="Description">
            <input type="number" name="category" id="category" required placeholder="Category">
            <input type="text" name="image" id="image" required placeholder="Image">

            <p class="resultRequestPost" style="display: none;"></p>
            <p class="resultRequestDelete" style="display: none;"></p>

            <button style="background-color: green; color: white; padding: 10px; width: 150px;">Enviar</button>

        </form>

    </div>


    <div style="margin-bottom: 100px;">   

        <h2 style="text-align: center;"> Formulário de Edição de produto - PUT </h2>

        <form class="formPut" id="formPut" style="display: flex; flex-direction: column; gap: 50px; width: 80%; align-items: center; justify-content: center; margin: 0 auto;">

            <input type="text" name="title" id="title" required placeholder="Título">
            <input type="number" name="price" id="price" required placeholder="Price">
            <input type="text" name="description" id="description" required placeholder="Description">
            <input type="number" name="category" id="category" required placeholder="Category">
            <input type="text" name="image" id="image" required placeholder="Image">

            <p class="resultRequestPut" style="display: none;"></p>

            <button style="background-color: blue; color: white; padding: 10px; width: 150px;">Editar</button>

        </form>

    </div>



    <div>   

        <h2 style="text-align: center;"> Formulário de Exclusão de produto - DELETE </h2>

        <form class="formDelete" id="formDelete" style="display: flex; flex-direction: column; gap: 50px; width: 80%; align-items: center; justify-content: center; margin: 0 auto;">

            <input type="text" name="id" id="id" required placeholder="Id">

            <p class="resultRequestPut" style="display: none;"></p>

            <button style="background-color: red; color: white; padding: 10px; width: 150px;">Excluir</button>

        </form>

    </div>
    

    <script>

        // Versão com a função retornando o valor via variável
        async function requestGetProduct() {
            
            const response = await fetch("https://fakestoreapi.com/products");

            const productsJson = await response.json();

            return productsJson;

        };

        /* Primeira versão com a função fazendo a requisição e inserindo no container da lista de produtos 
        async function requestGetProduct(list) {
            
            // Realizando uma requisição GET
            await fetch ("https://fakestoreapi.com/products")
            .then(response => response.json())
            .then(data => {

                data.forEach(element => {

                    const li = document.createElement('li');

                    li.textContent = `Id: ${element.id}; Title: ${element.title}; Price: ${element.price}`

                    list.appendChild(li);

                });

            })
            .catch(error => console.log("Erro na requisição GET: ", error));

        };

        */

        function requestPostProduct(form, paragraph) {
            
            const dataPost = new FormData(form);

            const objetoPost = Object.fromEntries(dataPost);

            // Realizando uma requisição POST assicrona
            fetch('https://fakestoreapi.com/products', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(objetoPost)
            })
            .then(response => response.json())
            .then(data => {
                
                console.log(`Resultado da requisição POST: `, data)
                paragraph.style.display = "flex";
                paragraph.textContent = "Requisição POST feita com sucesso!";
                
            })
            .catch(error => {

                console.log(`Erro na requisição POST: ${error}`);
                paragraph.style.display = "flex";
                paragraph.textContent = "Erro na requisição POST.";

            });

        };

        function requestPutProduct(form, paragraph) {
            
            // Realizando uma requisição PUT
            const dataPut = new FormData(form);
            dataPut.append('id', 21); // adcionando um novo elemento na coleção
            dataPut.set('title', 'Produto 2'); // alterando os dados do form para usar no request PUT
            const objetoPut = Object.fromEntries(dataPut);

           fetch(`https://fakestoreapi.com/products/${objetoPut.id}`, {
                method: 'PUT',
                headers: { 'Content-Type':'application/json' },
                body: JSON.stringify(objetoPut)
            })
            .then(response => response.json())
            .then(data => {

                console.log(`Resultado da requisição PUT:`, data);
                paragraph.style.display = "flex";
                paragraph.textContent = "Requisição PUT feita com sucesso!";

            })
            .catch(error => {

                console.log(`Erro na requisição PUT: ${error}`);
                paragraph.style.display = "flex";
                paragraph.textContent = "Erro na requisição PUT.";

            });

        };


        function requestDeleteProduct(id, paragraph) {

            // Realizando uma requisição DELETE
            fetch(`https://fakestoreapi.com/products/${id}`)
            .then(response => response.json())
            .then(data => {

                console.log("Resposta da requisição DELETE: ", data);
                paragraph.style.display = "flex";
                paragraph.textContent = "Requisição DELETE feita com sucesso!";

            })
            .catch(error => {
                console.log(`Erro na requisição DELETE: ${error}`);
                paragraph.style.display = "flex";
                paragraph.textContent = "Erro na requisição DELETE.";
            });
            
        };

        const formPost = document.querySelector(".formPost");
        const list = document.querySelector(".list");

        const resultRequestPost = document.querySelector(".resultRequestPost");
        const resultRequestPut = document.querySelector(".resultRequestPut");
        const resultRequestDelete = document.querySelector(".resultRequestDelete");


        document.addEventListener("DOMContentLoaded", async function() {

            /*
            requestGetProduct().then(products => {

                products.forEach(element => {

                    const li = document.createElement('li');

                    li.textContent = `Id: ${element.id}; Title: ${element.title}; Price: ${element.price}`

                    list.appendChild(li);

                });

            }).catch(error => {
                console.log("Erro na requisição GET dos produtos: ", error)
            }); 
            */

            /* Para receber o possível erro da promisse do fetch, 
                quando usado async e await, precisa utilizar o try-catch */
            try {
                
                const products = await requestGetProduct();
                console.log(products);

                // funciona como um container evitando que os elementos sejam 
                const containerFragment = new DocumentFragment();

                products.forEach(product => {
                    
                    const li = document.createElement("li");

                    li.textContent = `Title: ${product.title}`;
                    li.style.fontFamily = "Arial"
                    li.style.marginTop = "20px";

                    containerFragment.appendChild(li);

                });


                list.appendChild(containerFragment);
                

            } catch (error) {
                console.log("Erro na requisição GET dos produtos: ", error);
            };

        });

        form.addEventListener("submit", function(event) {

            event.preventDefault();

            requestPostProduct(form, resultRequestPost);

            requestPutProduct(form, resultRequestPut);

            requestDeleteProduct(1, resultRequestDelete);

        });


    </script>
    
</body>
</html>